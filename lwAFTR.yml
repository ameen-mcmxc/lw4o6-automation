---
-  hosts: localhost
   any_errors_fatal: true
   gather_facts: no

   tasks:
   - name: Update the machine
     tags: upd
     yum:
       update_only: yes

   - name: Install General Essential packages
     tags: essentials
     yum: 
       name: 
         - nano
         - net-tools
         - tcpdump
         - nmap
         - wireshark
         - git
         - wget
         - iproute
         - psmisc
         - yum-utils
         - chrony
         - telnet
         - iptables-services
         - conntrack
         - gcc
         - bridge-utils
       state: present

   - name: Set the timezone.
     tags: NTP
     shell: |
       timedatectl set-ntp true
       timedatectl set-timezone Europe/Berlin


   - name: Edit "/etc/sysctl.conf" file
     tags: sysctl
     lineinfile:
       path: /etc/sysctl.conf
       line: " net.ipv4.ip_forward = 1 \n  net.ipv6.conf.all.forwarding = 1 \n net.ipv4.conf.all.accept_redirects = 0  \n net.ipv4.conf.all.send_redirects = 0 "  

   - name: Clone snabb-repo
     tags: sanbb
     git:
       repo: https://github.com/eugeneia/snabb.git
       single_branch: yes
       version: lwaftr-tutorial
       dest: /root/
       clone: yes
       update: yes

   - name: Compile everything.
     tags: snabb
     shell: make
     args:
       chdir: /root/snabb

   - name: Pause for 50 seconds till compiler is done.
     ansible.builtin.pause:
       seconds: "50"

   - name: Create 'lwaftr-start.conf' file 
     tags: snabb
     ansible.builtin.template:
       src: /root/lw4o6-automation/files/lwaftr.txt
       dest: /root/snabb/lwaftr-start.conf
       owner: root
       mode: '755'

   - name: Create Networking file 
     tags: snabb
     ansible.builtin.template:
       src: /root/lw4o6-automation/files/lwaftr-networking.txt
       dest: /root/networking.sh
       owner: root
       mode: '755'
